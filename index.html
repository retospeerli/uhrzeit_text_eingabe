<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Uhrzeit – Umgangssprache</title>

<style>
  body{
    margin:0;
    background:#f3f4f6;
    font-family:system-ui, sans-serif;
    display:flex;
    justify-content:center;
    padding:16px;
  }
  .app{
    background:#fff;
    border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
    max-width:640px;
    width:100%;
    padding:1.2rem;
  }
  h1{ text-align:center; margin:.2rem 0 .4rem; }
  .subtitle{
    text-align:center;
    color:#4b5563;
    font-size:.95rem;
    margin-bottom:.6rem;
  }
  .clock-wrap{ display:flex; justify-content:center; margin:.6rem 0; }
  canvas{ background:#f9fafb; border-radius:50%; box-shadow:inset 0 0 5px rgba(0,0,0,.08); }

  .dropdowns{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:.5rem;
    margin-top:.6rem;
  }
  label{
    font-size:.8rem;
    color:#6b7280;
    font-weight:700;
    display:block;
    margin:0 0 .2rem .1rem;
  }
  select{
    width:100%;
    padding:.6rem;
    font-size:1.05rem;
    font-weight:700;
    border-radius:12px;
    border:2px solid #d1d5db;
    background:#fff;
  }

  button{
    width:100%;
    margin-top:.7rem;
    padding:.75rem;
    border-radius:999px;
    border:none;
    background:#2563eb;
    color:white;
    font-size:1.05rem;
    font-weight:800;
    cursor:pointer;
  }
  button:active{ transform:translateY(1px); }
  .feedback{
    text-align:center;
    font-weight:800;
    margin-top:.65rem;
    min-height:1.5rem;
  }
  .ok{ color:#15803d; }
  .bad{ color:#b91c1c; }

  .tiny{
    margin-top:.35rem;
    text-align:center;
    color:#6b7280;
    font-size:.85rem;
  }
</style>
</head>

<body>
<div class="app">
  <h1>Wie spät ist es?</h1>
  <div class="subtitle">Lies die Uhr ab und beschreibe die Zeit in Umgangssprache (ohne Audio).</div>

  <div class="clock-wrap">
    <canvas id="clock" width="260" height="260"></canvas>
  </div>

  <div class="dropdowns">
    <div>
      <label>minuten</label>
      <select id="sel-min">
        <option value="">—</option>
        <option value="fünf">fünf</option>
        <option value="zehn">zehn</option>
        <option value="viertel">viertel</option>
        <option value="zwanzig">zwanzig</option>
      </select>
    </div>

    <div>
      <label>form</label>
      <select id="sel-form">
        <option value="punkt">punkt</option>
        <option value="nach">nach</option>
        <option value="vor">vor</option>
        <option value="halb">halb</option>
        <option value="vor halb">vor halb</option>
        <option value="nach halb">nach halb</option>
      </select>
    </div>

    <div>
      <label>stunde</label>
      <select id="sel-hour">
        <option>eins</option><option>zwei</option><option>drei</option>
        <option>vier</option><option>fünf</option><option>sechs</option>
        <option>sieben</option><option>acht</option><option>neun</option>
        <option>zehn</option><option>elf</option><option>zwölf</option>
      </select>
    </div>
  </div>

  <button id="btn-check" type="button">prüfen</button>
  <div id="feedback" class="feedback"></div>
  <div class="tiny" id="hint"></div>
</div>

<script>
  // ======= Daten / Helpers =======
  const HOUR_WORDS = ["eins","zwei","drei","vier","fünf","sechs","sieben","acht","neun","zehn","elf","zwölf"];

  const toHourNum = (w) => HOUR_WORDS.indexOf(w) + 1; // 1..12
  const prevHour = (h) => (h === 1 ? 12 : h - 1);

  const MIN_AFTER = { "fünf":5, "zehn":10, "viertel":15, "zwanzig":20 };
  const MIN_BEFORE = { "fünf":55, "zehn":50, "viertel":45, "zwanzig":40 };

  function randInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // erlaubte Minuten (du kannst das später nach Klasse filtern)
  const ALLOWED_MINUTES = [0,5,10,15,20,25,30,35,40,45,50,55];

  // ======= State =======
  let current = { h: 12, m: 0 };

  // ======= Clock Drawing =======
  const canvas = document.getElementById("clock");
  const ctx = canvas.getContext("2d");

  function drawClock(h, m){
    const W = canvas.width;
    const H = canvas.height;
    const R = Math.min(W,H)/2 - 12;
    const cx = W/2;
    const cy = H/2;

    ctx.clearRect(0,0,W,H);

    // Face
    ctx.save();
    ctx.translate(cx, cy);

    ctx.beginPath();
    ctx.arc(0,0,R,0,Math.PI*2);
    ctx.fillStyle = "#ffffff";
    ctx.fill();
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#111827";
    ctx.stroke();

    // hour ticks
    for(let i=0;i<12;i++){
      const a = i*(Math.PI/6) - Math.PI/2;
      const inner = R - 10;
      const outer = R - (i%3===0 ? 22 : 16);
      ctx.beginPath();
      ctx.moveTo(inner*Math.cos(a), inner*Math.sin(a));
      ctx.lineTo(outer*Math.cos(a), outer*Math.sin(a));
      ctx.lineWidth = (i%3===0 ? 4 : 2);
      ctx.strokeStyle = "#111827";
      ctx.stroke();
    }

    // minute hand (blue)
    const ma = (Math.PI/30)*m - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo((R-28)*Math.cos(ma), (R-28)*Math.sin(ma));
    ctx.lineWidth = 6;
    ctx.strokeStyle = "#2563eb";
    ctx.lineCap = "round";
    ctx.stroke();

    // hour hand (red)
    const ha = (Math.PI/6)*( (h%12) + m/60 ) - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo((R-60)*Math.cos(ha), (R-60)*Math.sin(ha));
    ctx.lineWidth = 8;
    ctx.strokeStyle = "#dc2626";
    ctx.lineCap = "round";
    ctx.stroke();

    // center
    ctx.beginPath();
    ctx.arc(0,0,6,0,Math.PI*2);
    ctx.fillStyle = "#111827";
    ctx.fill();

    ctx.restore();
  }

  // ======= Task generation =======
  function newTask(){
    const h = randInt(1, 12);
    const m = ALLOWED_MINUTES[randInt(0, ALLOWED_MINUTES.length-1)];
    current = { h, m };
    drawClock(current.h, current.m);

    // reset UI
    document.getElementById("feedback").textContent = "";
    document.getElementById("feedback").className = "feedback";
    document.getElementById("hint").textContent = "";

    // reset dropdowns
    document.getElementById("sel-min").value = "";
    document.getElementById("sel-form").value = "punkt";
    document.getElementById("sel-hour").value = "eins";
  }

  // ======= Convert dropdowns -> (h,m) =======
  function selectionToTime(minWord, formWord, hourWord){
    const H = toHourNum(hourWord); // spoken hour
    let h, m;

    if(formWord === "punkt"){
      h = H;
      m = 0;
      return { h, m, valid:true };
    }

    if(formWord === "halb"){
      h = prevHour(H);
      m = 30;
      return { h, m, valid:true };
    }

    if(formWord === "vor halb"){
      h = prevHour(H);
      m = 25;
      return { h, m, valid:true };
    }

    if(formWord === "nach halb"){
      h = prevHour(H);
      m = 35;
      return { h, m, valid:true };
    }

    if(formWord === "nach"){
      if(!MIN_AFTER[minWord]) return { valid:false };
      h = H;
      m = MIN_AFTER[minWord];
      return { h, m, valid:true };
    }

    if(formWord === "vor"){
      if(!MIN_BEFORE[minWord]) return { valid:false };
      h = prevHour(H);
      m = MIN_BEFORE[minWord];
      return { h, m, valid:true };
    }

    return { valid:false };
  }

  // ======= Check =======
  function check(){
    const minWord = document.getElementById("sel-min").value;   // may be ""
    const formWord = document.getElementById("sel-form").value; // always set
    const hourWord = document.getElementById("sel-hour").value;

    const fb = document.getElementById("feedback");
    const hint = document.getElementById("hint");

    const sel = selectionToTime(minWord, formWord, hourWord);

    if(!sel.valid){
      fb.textContent = "unvollständig – wähle passende minuten";
      fb.className = "feedback bad";
      return;
    }

    const ok = (sel.h === current.h && sel.m === current.m);

    if(ok){
      fb.textContent = "richtig ✔";
      fb.className = "feedback ok";
      // next task shortly
      setTimeout(newTask, 600);
    } else {
      fb.textContent = "falsch ✘";
      fb.className = "feedback bad";
      // (absichtlich) keine Lösung anzeigen – nur Hinweis
      hint.textContent = "tipp: bei „halb / vor halb / nach halb“ ist die genannte stunde die nächste stunde.";
    }
  }

  // ======= Events =======
  document.getElementById("btn-check").addEventListener("click", check);

  // initial
  newTask();
</script>
</body>
</html>
